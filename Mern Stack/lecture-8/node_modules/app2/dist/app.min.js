!function(e){function n(n,t){var o,a="!"==n.slice(0,1),i=a?n.slice(1):n,c=i.split(/\s+/g),f=c[0];return c.length<=1?void console.error("无法解析事件 "+n):(c.shift(),o=c.join(" "),void("window"==o||"document"==o?"window"==o?$(e).on(f,function(e){t.call(r.event,e)}):$(document).on(f,function(e){t.call(r.event,e)}):a?$(o).on(f,function(e){t.call(r.event,e)}):r.event.el?$(r.event.el).on(f,o,function(e){t.call(r.event,e)}):$(document).on(f,o,function(e){t.call(r.event,e)})))}function t(e){var t=e.event,o=t.events;Object.keys(t.events).map(function(e){t[o[e]]?n(e,t[o[e]]):console.error("方法 "+o[e]+" 不存在")})}function o(e){var n,t={};if(e.templateRenderer&&"function"==typeof e.templateRenderer)n=e.templateRenderer;else{if("function"!=typeof juicer)return void console.error("config.templateRenderer 没有配置，也没有加载juicer，故不能编译模板");n=juicer}Object.keys(e.template).map(function(o){"object"==typeof e.template[o]?(t[o]={},Object.keys(e.template[o]).map(function(a){"object"==typeof e.template[o][a]?(t[o][a]={},Object.keys(e.template[o][a]).map(function(r){t[o][a][r]=n(e.template[o][a][r])})):t[o][a]=n(e.template[o][a])})):t[o]=n(e.template[o])}),e.compiledTemplate=t}function a(e,n,t,o){var a,i=r.compiledTemplate,c=o?"append":"html",f=!!~n.indexOf("."),s=f&&n.split(".");if(f)if(2==s.length)a=!!i[s[0]]&&i[s[0]][s[1]];else{if(3!=s.length)return void console.error("模板最大只支持3级");a=!!i[s[0]]&&!!i[s[0]][s[1]]&&i[s[0]][s[1]][s[2]]}else a=i[n];a?e[c](a.render(t)):console.error("模板 "+n+" 不存在")}!function(e){function n(e){return e}function t(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var n,a=arguments[1],r=!0;a instanceof Array||(a=e,r=!1);var i,c={};for(i in a)n=r?a[i]:i,e.hasOwnProperty(n)&&(e[n]instanceof Array?c[n]=o(e[n]):"object"==typeof e[n]?c[n]=t(e[n]):c[n]=e[n]);return c}function o(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var n=[];return e.map(function(e,o){"object"!=typeof e?n[o]=e:n[o]=t(e)}),n}function a(n,t){switch(t){case"int":return parseInt(n);case"float":return parseFloat(n);case"bool":return!!n;case"string":return n+"";default:return e[t]&&"function"==typeof e[t]?n=e[t](n):console.error(""+t+"：没有此内置操作，也无此全局函数"),n}}function r(e,n,r,i){var c,s=r.split("."),u=s.length,l=s[u-1],p=!!~l.indexOf("[]");if(2==u)c=p?void 0!=e[s[0]]&&e[s[0]]:void 0!=e[s[0]]&&e[s[0]][s[1]];else if(3==u)c=p?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");c=p?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]][s[3]]}p?e[n]=f(c,l):"object"!=typeof c?e[n]=i?a(c,i):c:Array.isArray(c)?e[n]=o(c):e[n]=t(c)}function i(e,n,t,o,r){var i=e[t];e[n]=o?a(i,o):i,n!=t&&!r&&delete e[t]}function c(e,n,t){e[n]=f(e,t)}function f(e,t){var o,a=t.split("|"),r=a[0].slice(0,-2),i=a[1],c=a[2],f=a[3],s=a[4],u=!!s,l=e[r],p=0,d=0,m=0,v=0,y=[];if(!l||!Array.isArray(l))return void console.error("配置的键 "+r+" 不存在，或者值不是数组");if(u)switch(s){case"round":o=Math.round;break;case"floor":o=Math.floor;break;case"ceil":o=Math.ceil;break;case"abs":o=Math.abs;break;default:o=n,"concat"!=c&&console.error("子操作 "+s+" 不存在")}switch(c){case"sum":return l.map(function(e){p+=u?o(e[i]):e[i]}),p;case"average":return l.map(function(e){p+=u?o(e[i]):e[i]}),d=p/l.length;case"max":return l.map(function(e,n){var t=u?o(e[i]):e[i];n?t>m&&(m=t):m=t}),m;case"min":return l.map(function(e,n){var t=u?o(e[i]):e[i];n?t<v&&(v=t):v=t}),v;case"concat":return l.map(function(e){var n=u?e[i][s]():e[i];y.push(n)}),y.join(f?f:"");default:return void console.error("操作 "+c+" 不存在")}}function s(e,n,t){var o=n[t],a=!!~o.indexOf("^"),f=a?o.slice(0,-1):o,s=f.split("!"),u=s[0],l=s[1],p=!!~u.indexOf("."),d=!p&&!!~u.indexOf("[]");p?u.split(".").length>1?r(e,t,u,l):console.error("配置键名 "+f+" 有误"):d?c(e,t,u):i(e,t,u,l,a)}function u(e,n){n&&"object"==typeof n&&(Array.isArray(n)?e.map(function(e){!!n[0]&&"object"==typeof n[0]&&"object"==typeof e&&u(e,n[0])}):Object.keys(n).map(function(t){var o,a;o=n[t],a="_"==t.slice(0,1)&&"undefined"==typeof e[t]?e[t.slice(1)]:e[t],"object"==typeof o&&a?Array.isArray(o)?a.map(function(e){o[0]&&"object"==typeof o[0]&&"object"==typeof e&&u(e,o[0])}):u(a,o):"string"==typeof o?s(e,n,t):console.error("无法解析key: \n"+("string"==typeof o?o:"object"==typeof o?JSON.stringify(o):""))}))}var l=function(e,n,a){var r=a?e instanceof Array?o(e):t(e):e;return n&&"object"==typeof n?u(r,n):console.error("传入的map格式有误，请传入对象或数组"),r};e.JSON.refactor=l}(e);var r={},i={},c={};i.getFormatData=function(e,n){var t=r.ajax.name[e],o=r.environment,a={};return void 0==o&&(console.error("环境变量 config.environment 没有配置, 默认取值为0的环境"),o=0),!t&&console.error("config.ajax.url中无 "+e+" 对应的值"),Array.isArray(n)?n.map(function(e,n){a[r.ajax.requestKeys[t][o][n]]=e}):Object.keys(n).map(function(e){a[r.ajax.requestKeys[t][o][e]]=n[e]}),[r.ajax.url[t][o],a]},i.preHandle=function(e,n){var t=r.ajax.name[n],o=r.environment,a=!!r.ajax.preHandle&&!!r.ajax.preHandle.common&&r.ajax.preHandle.common,i=!!r.ajax.preHandle&&!!r.ajax.preHandle[t]&&r.ajax.preHandle[t];!!a&&("function"==typeof a?!o&&a(e):!!a[o]&&a[o](e)),!!i&&("function"==typeof i?!o&&i(e):!!i[o]&&i[o](e))},i.postHandle=function(e,n){var t=r.ajax.name[n],o=r.environment,a=!!r.ajax.postHandle&&!!r.ajax.postHandle.common&&r.ajax.postHandle.common,i=!!r.ajax.postHandle&&!!r.ajax.postHandle[t]&&r.ajax.postHandle[t],c=!!r.ajax.responseRefactor&&!!r.ajax.responseRefactor.common&&r.ajax.responseRefactor.common,f=!!r.ajax.responseRefactor&&!!r.ajax.responseRefactor[t]&&r.ajax.responseRefactor[t];!!c&&(Array.isArray(c)?!!c[o]&&JSON.refactor(e,c[o]):!o&&JSON.refactor(e,c)),!!f&&(Array.isArray(f)?!!f[o]&&JSON.refactor(e,f[o]):!o&&JSON.refactor(e,f)),!!a&&("function"==typeof a?!o&&a(e):!!a[o]&&a[o](e)),!!i&&("function"==typeof i?!o&&i(e):!!i[o]&&i[o](e))},i.send=function(e,n,t,o,a,r){var c=i.getFormatData(n,t);!a&&(a="json"),i.preHandle(c[1],n),$[e](c[0],r?JSON.stringify(c[1]):c[1],function(e){i.postHandle(e,n),o(e)},a)},i.get=function(e,n,t,o){i.send("get",e,n,t,o,!1)},i.post=function(e,n,t,o,a){4==arguments.length&&"boolean"==typeof o&&(a=o,o="json"),i.send("post",e,n,t,o,a)},c.data={},c.bind=function(e){Object.keys(e.dataBind).map(function(e){c.data[e]={}})},c._setData=function(e,n,t){if(!r.dataBind[e])return void console.error("配置的数据绑定键名 "+e+" 不存在");void 0==t&&(t=!1);var o,i,c=r.dataBind[e],f=c.template,s=$(c.element),u=!t,l=!1;return f?("object"==typeof f&&(l=!0,i=Object.keys(f)[0]),void(t?Array.isArray(n)?n.map(function(e){o=l?f[i][e[i]]:f,a(s,o,e,!0)}):(o=l?f[i][n[i]]:f,a(s,o,n,!0)):Array.isArray(n)?n.map(function(e){o=l?f[i][e[i]]:f,u?(a(s,o,e),u=!1):a(s,o,e,!0)}):(o=l?f[i][n[i]]:f,a(s,o,n)))):void console.error("键名 "+e+" 对应的模板名不能为空")},c.setData=function(e,n){c._setData(e,n,!1)},c.addData=function(e,n){c._setData(e,n,!0)};var f={init:function(e){r=e,!!r.event&&!!r.event.events&&t(r),!!r.template&&o(r),!!r.dataBind&&c.bind(r),f.get=i.get,f.post=i.post,f.setData=c.setData,f.addData=c.addData,f.compiledTemplate=r.compiledTemplate}};"function"==typeof define&&define.amd?define(function(){return f}):"undefined"!=typeof module&&module.exports?module.exports=f:e.app=f}(window);